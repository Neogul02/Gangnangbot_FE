{
    "openapi": "3.1.0",
    "info": {
        "title": "Kangnam Agent API",
        "description": "강남대학교 Multi-Agent 챗봇 API",
        "version": "2.0.0"
    },
    "paths": {
        "/sessions/": {
            "post": {
                "tags": [
                    "sessions"
                ],
                "summary": "Create Session",
                "description": "새로운 채팅 세션 생성\n\nHeaders:\n    Authorization: Bearer {access_token}\n\nReturns:\n    session_id: 세션 UUID\n    user_id: 사용자 ID\n    title: \"새로운 대화\" (첫 메시지 전송 시 자동 업데이트)\n    created_at: 생성 시각\n    message: 성공 메시지\n    \nNote:\n    세션 생성 직후 첫 메시지를 보내면, 해당 메시지가 title로 설정됩니다.",
                "operationId": "create_session_sessions__post",
                "security": [
                    {
                        "HTTPBearer": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/CreateSessionResponse"
                                }
                            }
                        }
                    }
                }
            },
            "get": {
                "tags": [
                    "sessions"
                ],
                "summary": "List Sessions",
                "description": "세션 목록 조회\n\n현재 로그인된 유저의 세션 목록을 반환합니다.\n\nHeaders:\n    Authorization: Bearer {access_token}\n\nQuery Parameters:\n    include_inactive: 비활성 세션 포함 여부 (기본값: False)\n\nReturns:\n    sessions: 세션 목록 (최신순)",
                "operationId": "list_sessions_sessions__get",
                "security": [
                    {
                        "HTTPBearer": []
                    }
                ],
                "parameters": [
                    {
                        "name": "include_inactive",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "boolean",
                            "default": false,
                            "title": "Include Inactive"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ListSessionsResponse"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HTTPValidationError"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/sessions/{session_id}/messages": {
            "get": {
                "tags": [
                    "sessions"
                ],
                "summary": "Get Session Messages",
                "description": "특정 세션의 메시지 내역 조회\n\nHeaders:\n    Authorization: Bearer {access_token}\n\nPath Parameters:\n    session_id: 세션 UUID\n\nQuery Parameters:\n    limit: 조회할 메시지 수 제한 (선택)\n\nReturns:\n    session_id: 세션 UUID\n    messages: 메시지 목록 (시간순)",
                "operationId": "get_session_messages_sessions__session_id__messages_get",
                "security": [
                    {
                        "HTTPBearer": []
                    }
                ],
                "parameters": [
                    {
                        "name": "session_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "title": "Session Id"
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "anyOf": [
                                {
                                    "type": "integer"
                                },
                                {
                                    "type": "null"
                                }
                            ],
                            "title": "Limit"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GetMessagesResponse"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HTTPValidationError"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/sessions/{session_id}": {
            "delete": {
                "tags": [
                    "sessions"
                ],
                "summary": "Delete Session",
                "description": "세션 비활성화 (소프트 삭제)\n\nHeaders:\n    Authorization: Bearer {access_token}\n\nPath Parameters:\n    session_id: 세션 UUID\n\nReturns:\n    message: 성공 메시지",
                "operationId": "delete_session_sessions__session_id__delete",
                "security": [
                    {
                        "HTTPBearer": []
                    }
                ],
                "parameters": [
                    {
                        "name": "session_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "title": "Session Id"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/DeleteSessionResponse"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HTTPValidationError"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/chat/message": {
            "post": {
                "tags": [
                    "chat"
                ],
                "summary": "Send Message",
                "description": "메시지 전송 및 스트리밍 응답\n\nAgent Engine에 메시지를 전송하고 SSE(Server-Sent Events) 방식으로\n스트리밍 응답을 반환합니다.\n\nHeaders:\n    Authorization: Bearer {access_token}\n\nBody:\n    session_id: 세션 UUID\n    message: 전송할 메시지\n\nResponse (SSE):\n    data: {\"text\": \"응답 텍스트\", \"done\": false}\n    data: {\"text\": \"\", \"done\": true}",
                "operationId": "send_message_chat_message_post",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/MessageRequest"
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {}
                            }
                        }
                    },
                    "422": {
                        "description": "Validation Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HTTPValidationError"
                                }
                            }
                        }
                    }
                },
                "security": [
                    {
                        "HTTPBearer": []
                    }
                ]
            }
        },
        "/auth/google/login": {
            "get": {
                "tags": [
                    "auth"
                ],
                "summary": "Google Login",
                "description": "Google OAuth 로그인 URL로 리다이렉트\n\nAuthlib이 자동으로 State 생성 및 세션 저장을 처리합니다.",
                "operationId": "google_login_auth_google_login_get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {}
                            }
                        }
                    }
                }
            }
        },
        "/auth/google/callback": {
            "get": {
                "tags": [
                    "auth"
                ],
                "summary": "Google Callback",
                "description": "Google OAuth 콜백 처리\n\nGoogle로부터 인증 코드를 받아 토큰으로 교환하고,\n사용자 정보를 DB에 저장한 후 JWT 토큰을 반환합니다.",
                "operationId": "google_callback_auth_google_callback_get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {}
                            }
                        }
                    }
                }
            }
        },
        "/auth/me": {
            "get": {
                "tags": [
                    "auth"
                ],
                "summary": "Get Me",
                "description": "현재 로그인된 사용자 정보 조회\n\nHeaders:\n    Authorization: Bearer {access_token}\n\nReturns:\n    사용자 정보 (id, email, name 등)",
                "operationId": "get_me_auth_me_get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {}
                            }
                        }
                    }
                },
                "security": [
                    {
                        "HTTPBearer": []
                    }
                ]
            }
        },
        "/auth/generate-token": {
            "post": {
                "tags": [
                    "auth"
                ],
                "summary": "Generate Test Token",
                "description": "테스트용 JWT 토큰 생성\n\n⚠️ 개발/테스트 전용 엔드포인트입니다.\n프로덕션 환경에서는 비활성화해야 합니다.\n\nQuery Parameters:\n    user_id: 토큰에 포함할 사용자 ID\n\nReturns:\n    access_token: 생성된 JWT 토큰\n    token_type: \"bearer\"\n\nExample:\n    POST /auth/generate-token?user_id=1",
                "operationId": "generate_test_token_auth_generate_token_post",
                "parameters": [
                    {
                        "name": "user_id",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "title": "User Id"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GenerateTokenResponse"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HTTPValidationError"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/profiles/": {
            "post": {
                "tags": [
                    "profiles"
                ],
                "summary": "Save Profile",
                "description": "프로필 정보를 Supabase의 profiles 테이블에 저장합니다.\n\nuser_id를 기준으로 기존 프로필이 있으면 업데이트하고, 없으면 새로 생성합니다.\n\nRequest Body:\n    user_id: 사용자 ID (bigint)\n    profile_name: 프로필 이름 (varchar(255))\n    student_id: 학번 (varchar(255))\n    college: 단과대학 정보 (varchar(255))\n    department: 학부/학과 (varchar(255))\n    major: 전공 정보 (varchar(255))\n    current_grade: 현재 학년 (integer)\n    current_semester: 현재 학기 (integer)\n\nReturns:\n    저장된 프로필 정보",
                "operationId": "save_profile_profiles__post",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/ProfileRequest"
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ProfileResponse"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HTTPValidationError"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/db/check-db": {
            "get": {
                "tags": [
                    "database"
                ],
                "summary": "Check Db Connection",
                "description": "데이터베이스 연결 상태를 확인합니다.",
                "operationId": "check_db_connection_db_check_db_get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {}
                            }
                        }
                    }
                }
            }
        },
        "/health": {
            "get": {
                "summary": "Health Check",
                "description": "헬스체크 엔드포인트",
                "operationId": "health_check_health_get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {}
                            }
                        }
                    }
                }
            }
        },
        "/": {
            "get": {
                "summary": "Root",
                "description": "API 정보",
                "operationId": "root__get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {}
                            }
                        }
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "CreateSessionResponse": {
                "properties": {
                    "session_id": {
                        "type": "string",
                        "title": "Session Id"
                    },
                    "user_id": {
                        "type": "integer",
                        "title": "User Id"
                    },
                    "title": {
                        "type": "string",
                        "title": "Title"
                    },
                    "created_at": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Created At"
                    }
                },
                "type": "object",
                "required": [
                    "session_id",
                    "user_id",
                    "title"
                ],
                "title": "CreateSessionResponse",
                "description": "세션 생성 응답"
            },
            "DeleteSessionResponse": {
                "properties": {
                    "message": {
                        "type": "string",
                        "title": "Message"
                    }
                },
                "type": "object",
                "required": [
                    "message"
                ],
                "title": "DeleteSessionResponse",
                "description": "세션 삭제 응답"
            },
            "GenerateTokenResponse": {
                "properties": {
                    "access_token": {
                        "type": "string",
                        "title": "Access Token"
                    },
                    "token_type": {
                        "type": "string",
                        "title": "Token Type"
                    },
                    "user_id": {
                        "type": "string",
                        "title": "User Id"
                    },
                    "note": {
                        "type": "string",
                        "title": "Note"
                    }
                },
                "type": "object",
                "required": [
                    "access_token",
                    "token_type",
                    "user_id",
                    "note"
                ],
                "title": "GenerateTokenResponse",
                "description": "토큰 생성 응답"
            },
            "GetMessagesResponse": {
                "properties": {
                    "session_id": {
                        "type": "string",
                        "title": "Session Id"
                    },
                    "messages": {
                        "items": {
                            "$ref": "#/components/schemas/MessageItem"
                        },
                        "type": "array",
                        "title": "Messages"
                    }
                },
                "type": "object",
                "required": [
                    "session_id",
                    "messages"
                ],
                "title": "GetMessagesResponse",
                "description": "메시지 목록 응답"
            },
            "HTTPValidationError": {
                "properties": {
                    "detail": {
                        "items": {
                            "$ref": "#/components/schemas/ValidationError"
                        },
                        "type": "array",
                        "title": "Detail"
                    }
                },
                "type": "object",
                "title": "HTTPValidationError"
            },
            "ListSessionsResponse": {
                "properties": {
                    "sessions": {
                        "items": {
                            "$ref": "#/components/schemas/SessionItem"
                        },
                        "type": "array",
                        "title": "Sessions"
                    }
                },
                "type": "object",
                "required": [
                    "sessions"
                ],
                "title": "ListSessionsResponse",
                "description": "세션 목록 응답"
            },
            "MessageItem": {
                "properties": {
                    "role": {
                        "type": "string",
                        "title": "Role"
                    },
                    "content": {
                        "type": "string",
                        "title": "Content"
                    },
                    "created_at": {
                        "type": "string",
                        "format": "date-time",
                        "title": "Created At"
                    }
                },
                "type": "object",
                "required": [
                    "role",
                    "content",
                    "created_at"
                ],
                "title": "MessageItem",
                "description": "메시지 항목"
            },
            "MessageRequest": {
                "properties": {
                    "session_id": {
                        "type": "string",
                        "title": "Session Id"
                    },
                    "message": {
                        "type": "string",
                        "title": "Message"
                    }
                },
                "type": "object",
                "required": [
                    "session_id",
                    "message"
                ],
                "title": "MessageRequest",
                "description": "메시지 전송 요청",
                "example": {
                    "message": "2024년 공과대학 졸업 요건 알려줘",
                    "session_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef"
                }
            },
            "ProfileRequest": {
                "properties": {
                    "user_id": {
                        "type": "integer",
                        "title": "User Id",
                        "description": "users 테이블의 id"
                    },
                    "profile_name": {
                        "type": "string",
                        "title": "Profile Name",
                        "description": "프로필 이름"
                    },
                    "student_id": {
                        "type": "string",
                        "title": "Student Id",
                        "description": "학번"
                    },
                    "college": {
                        "type": "string",
                        "title": "College",
                        "description": "단과대학 정보"
                    },
                    "department": {
                        "type": "string",
                        "title": "Department",
                        "description": "학부/학과"
                    },
                    "major": {
                        "type": "string",
                        "title": "Major",
                        "description": "전공 정보"
                    },
                    "current_grade": {
                        "type": "integer",
                        "title": "Current Grade",
                        "description": "현재 학년"
                    },
                    "current_semester": {
                        "type": "integer",
                        "title": "Current Semester",
                        "description": "현재 학기"
                    }
                },
                "type": "object",
                "required": [
                    "user_id",
                    "profile_name",
                    "student_id",
                    "college",
                    "department",
                    "major",
                    "current_grade",
                    "current_semester"
                ],
                "title": "ProfileRequest",
                "description": "프로필 저장 요청"
            },
            "ProfileResponse": {
                "properties": {
                    "id": {
                        "type": "integer",
                        "title": "Id"
                    },
                    "user_id": {
                        "type": "integer",
                        "title": "User Id"
                    },
                    "profile_name": {
                        "type": "string",
                        "title": "Profile Name"
                    },
                    "student_id": {
                        "type": "string",
                        "title": "Student Id"
                    },
                    "college": {
                        "type": "string",
                        "title": "College"
                    },
                    "department": {
                        "type": "string",
                        "title": "Department"
                    },
                    "major": {
                        "type": "string",
                        "title": "Major"
                    },
                    "current_grade": {
                        "type": "integer",
                        "title": "Current Grade"
                    },
                    "current_semester": {
                        "type": "integer",
                        "title": "Current Semester"
                    },
                    "created_at": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Created At"
                    },
                    "updated_at": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Updated At"
                    }
                },
                "type": "object",
                "required": [
                    "id",
                    "user_id",
                    "profile_name",
                    "student_id",
                    "college",
                    "department",
                    "major",
                    "current_grade",
                    "current_semester"
                ],
                "title": "ProfileResponse",
                "description": "프로필 저장 응답"
            },
            "SessionItem": {
                "properties": {
                    "sid": {
                        "type": "string",
                        "title": "Sid"
                    },
                    "title": {
                        "type": "string",
                        "title": "Title"
                    },
                    "is_active": {
                        "type": "boolean",
                        "title": "Is Active"
                    },
                    "created_at": {
                        "type": "string",
                        "format": "date-time",
                        "title": "Created At"
                    }
                },
                "type": "object",
                "required": [
                    "sid",
                    "title",
                    "is_active",
                    "created_at"
                ],
                "title": "SessionItem",
                "description": "세션 목록 항목"
            },
            "ValidationError": {
                "properties": {
                    "loc": {
                        "items": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "integer"
                                }
                            ]
                        },
                        "type": "array",
                        "title": "Location"
                    },
                    "msg": {
                        "type": "string",
                        "title": "Message"
                    },
                    "type": {
                        "type": "string",
                        "title": "Error Type"
                    }
                },
                "type": "object",
                "required": [
                    "loc",
                    "msg",
                    "type"
                ],
                "title": "ValidationError"
            }
        },
        "securitySchemes": {
            "HTTPBearer": {
                "type": "http",
                "scheme": "bearer"
            }
        }
    }
}